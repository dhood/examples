# generated from rclcpp_examples/test/test_executable_linking.py.in

import os
import re
import subprocess 

def setup():
    os.environ['OSPL_VERBOSITY'] = '8'  # 8 = OS_NONE


def test_executable():

    rmw_implementation = '@rmw_implementation@'
    executables = '@RCLCPP_EXAMPLES_EXECUTABLE@'.split(';')
    for exe in executables:
        # Check that the executable is linked against the claimed rmw implementation
        cmd = ['ldd', exe]
        dependencies = subprocess.check_output(cmd)
        pattern = re.compile(rmw_implementation.encode(), flags=re.IGNORECASE)
        relevant_links = pattern.findall(dependencies)
        assert len(relevant_links) > 0, \
            "Executable is not linked against RMW implementation '%s'." % rmw_implementation

if __name__ == '__main__':
    test_executable()
